# Setup guide

Bureau's bootstrap script handles all setup automatically, providing sensible default configuration out of the box. 

> [!TIP]
>
> You can fully set up Bureau in 5 minutes if you like.
>
> ### Abbreviated setup steps
> 
> 1. **Ensure deps:** Node.js 20+, Python 3.12+ with [`uv`](https://docs.astral.sh/uv/), Docker daemon *(Rancher or Docker Desktop)*
> 2. In your shell profile (`.zshrc`/`.bashrc`): 
>     
>     - **Set API keys:** [`TAVILY_API_KEY`](https://www.tavily.com/), [`BRAVE_API_KEY`](https://brave.com/search/api/), [`CONTEXT7_API_KEY`](https://console.upstash.com/) **(all offer free tiers)**
>     - Add the following directories to `$PATH`:
> 
>       - [`bureau/bin/`](../bin/)
>       - `~/.local/bin` *(only if using **Gemini CLI** and/or **Codex**)*
> 
> 3. **Create `local.yml` in the repo root (recommended)** or edit [`directives.yml`](../directives.yml) to set `path_to.workspace` to where you keep the repos/projects you want to work on, e.g.:
>       
>       ```yml
>       # local.yml
>       path_to:
>           workspace: ~/code  # default value used by Bureau
>       ```
> 
> 4. **Run [`open-bureau`](../bin/open-bureau)** *(`bin/open-bureau` if `bureau/bin/` wasn't added to `$PATH`)*
> 5. *Only if using Claude Code:* install the **Claude Code plugins** [discussed below](#install-plugins-claude-code-only)
> 6. Follow the **verification steps** [discussed below](#verify-setup-optional) to ensure setup was successful.
> 7. Read **Bureau's [5-minute guide to using GitHub SpecKit](USAGE.md#using-github-speckit-cli)** *(optional but highly recommended)*
> 8. **When you stop working or take a break:** 
>   
>     - Stop the local servers & containers **in seconds with one quick script:** `close-bureau` *(generated by `open-bureau`)*
>     - To start Bureau up again, simply re-run `open-bureau` *(should take <15 seconds after the first-ever run)*
>
> After completing the steps above, you're ready to go! For further info, see:
> 
> - the [usage guide](USAGE.md) for full details on workflows Bureau enables.
> - the [configuration reference](CONFIGURATION.md) for full customization steps and all available settings.

***Contents:***

- [Prerequisites](#prerequisites)
  - [Supported CLI coding agents](#supported-cli-coding-agents)
  - [Dependencies](#dependencies)
  - [API keys *(for remote/cloud-based MCP servers)*](#api-keys-for-remotecloud-based-mcp-servers)
- [Setup](#setup)
  - [Configure `$PATH`](#configure-path)
  - [Set Bureau workspace path (`path_to.workspace`)](#set-bureau-workspace-path-path_toworkspace)
  - [Run `open-bureau`](#run-open-bureau)
  - [Install plugins *(Claude Code only)*](#install-plugins-claude-code-only)
- [Verifying setup](#verifying-setup)
- [Stopping servers](#stopping-servers)
- [Configuration (key details)](#configuration-key-details)
  - [How to tweak settings](#how-to-tweak-settings)
  - [Key default config values](#key-default-config-values)
  - [Simple power user configuration example](#simple-power-user-configuration-example)
- [Troubleshooting](#troubleshooting)


## Prerequisites

### Supported CLI coding agents

To use Bureau, you need at least one of the following:

| Supported agent CLI | User-scoped config dir *(that Bureau will configure)* |
| --- | --- |
| Claude Code | `~/.claude/` (and `.claude.json` indirectly via `claude ...` commands) |
| Codex | `~/.codex/` |
| Gemini CLI | `~/.gemini/` |
| OpenCode | `~/.config/opencode/` |

### Dependencies 

- Node.js 20+ (includes npm 10+)
- Python 3.12+ with [`uv`](https://docs.astral.sh/uv/)
- Docker Desktop or Rancher Desktop

### API keys *(for remote/cloud-based MCP servers)*

> [!NOTE]
> All the servers requiring API keys have **free versions with generous monthly usage limits: you don't have to pay anything to use them** if you don't want to.

Make sure the following environment variables are set (e.g. in your `.zshrc/.bashrc`):

- `TAVILY_API_KEY` [(get one here)](https://www.tavily.com/)
- `BRAVE_API_KEY` [(get one here)](https://brave.com/search/api/)
- `CONTEXT7_API_KEY` [(get one here)](https://console.upstash.com/)

## Setup

### Configure `$PATH`

In your shell profile (`~/.zshrc`, `~/.bashrc`, etc.), add the following paths to your `PATH` environment variable:

| Path | What Bureau keeps here |
| :--- | :--- |
| This repo's [`bin/` directory](../bin/) | One-shot startup & takedown scripts ([details below](#run-open-bureau))

### Set Bureau workspace path (`path_to.workspace`)

**Create `local.yml` in the repo root (recommended)** or edit [`directives.yml`](../directives.yml) to set `path_to.workspace` to where you keep the repos/projects you want to work on, e.g.:
       
```yml
# local.yml
path_to:
    workspace: ~/code  # default value used by Bureau
```

### Run `open-bureau`

Bureau provides an idempotent, one-shot bootstrap/setup script:

```bash
$ open-bureau  # in this repo's bin/
```

> [!NOTE]
> 
> The `open-bureau` script:
> 
> - **may take up to 5 minutes** on the **first run *only*** 
>   
>   - *this is due to having to clone the MCP servers that must be run from source (cloned to `bureau/.mcp-servers/` by default)*
> 
> - is **idempotent** ➔ running multiple times won't cause any:
>     - duplicated configs
>     - unnecessary restarts or duplicate instances of locally-run servers/containers

> [!IMPORTANT]
>
> **`open-bureau` <ins>must</ins> be re-run after editing any config values** in the Bureau `.yml` files, i.e. [`charter.yml`](../charter.yml), [`directives.yml`](../directives.yml) (and `local.yml` if you've created one).

#### What `open-bureau` does *(optional extra info)*

1. Checks prerequisites and installs Python dependencies
2. Installs Bureau's non-MCP CLI tools (e.g. GitHub SpecKit)
3. Clones MCP servers that must be run from source
4. Starts MCP servers (and backing containers where needed) and sets up all enabled CLI agents to use them
5. Sets up agent role prompts and custom slash commands/launch wrappers for them *(to allow interactive use as main agents)*
6. Generates context files for each enabled CLI *(and symlinks into the appropriate user-scoped config dir)*: 
    
    - `~/.claude/CLAUDE.md`
    - `~/.codex/AGENTS.md`
    - `~/.gemini/GEMINI.md`
    
> [!NOTE]
> These are the files enabling *automatic context injection*: 
> 
> - They guide agents to read *Bureau's custom context files* that teach them to **<ins>autonomously</ins> use Bureau's functionality** *without* explicitly being prompted to by the user.
> - This **<ins>minimizes the learning curve</ins>, letting you get to work as fast as possible.**

7. Generates:

    - PAL MCP config files for each enabled CLI and symlinks into the PAL MCP config dir (`~/.pal/cli_clients/`)
    - the **`close-bureau` script allowing easy shutdown** of *all* daemons/containers launched by Bureau *(placed in the `bureau/bin/` directory)*

### Install plugins *(Claude Code only)*

After launching Claude Code, install these plugins *(highly recommended for **even more accurate & reliable autonomous agents**)*:

```bash
$ claude 
# ... startup output ...

# install claude-mem
> /plugin marketplace add thedotmack/claude-mem
> /plugin install claude-mem

# install Superpowers
> /plugin marketplace add obra/superpowers-marketplace
> /plugin install superpowers@superpowers-marketplace
```

> [!NOTE]
> 
> Codex also works with Superpowers: Bureau sets it up **automatically** (via cloning the repo to the user-scoped `~/.codex/`).\
> No manual setup is needed.

> [!IMPORTANT]
> 
> ### Startup & shutdown: *easy, fast workflow*
> 
> Going forward, all you need to keep in mind is that you can:
> 
> - **Shut down Bureau via `close-bureau`** when you stop working or take a break.\
>   ➔ *stops servers/containers to save memory/CPU/power*
> - **Easily and quickly start it up with `open-bureau`** when you need it again.\
>   ➔ *takes <15 seconds after the first-ever setup run*

## Verifying setup

<details>
<summary><strong>Claude Code</strong></summary>

1. Run `/status`: it should show `Memory: user (~/.claude/CLAUDE.md)`
2. Run `/mcp`: it should list Bureau's MCP servers (qdrant, sourcegraph, etc.)
3. Run `/explainer` *(custom role activation command set up by Bureau)*: it should launch the [`explainer`](../agents/role-prompts/explainer.md) agent for interactive use in the main conversation.

    > You can test this with any role prompt in [`agents/claude-subagents/`](../agents/claude-subagents/): the custom command created for each role will have the form `/<basename>`, using the basename of each file in the directory.

4. If `claude-mem` is installed, you'll see context loaded at startup

</details>

<details>
<summary><strong>Gemini CLI</strong></summary>

1. Run `/memory show`: should show content from `GEMINI.md`
2. Check `Using:` line shows `1 GEMINI.md file`
3. Run `gemini-explainer` *(custom launch wrapper set up by Bureau)* from the command line to see if it launches Gemini with the [`explainer`](../agents/role-prompts/explainer.md) agent active in the *main conversation*
    
    > You can test this with any role prompt in [`agents/role-prompts/`](../agents/role-prompts/): the launch wrapper created for each role will have the form `gemini-<basename>` for each file in the directory.

</details>

<details>
<summary><strong>Codex</strong></summary>

1. Ask: "What must-read files were you given?"
2. Should reference delegation rules and clink
3. Run `~/.codex/superpowers/.codex/superpowers-codex find-skills` to verify Superpowers
4. Run `codex-explainer` *(custom launch wrapper set up by Bureau)* from the command line to see if it launches Codex with the [`explainer`](../agents/role-prompts/explainer.md) agent active in the *main conversation*
    
    > You can test this with any role prompt in [`agents/role-prompts/`](../agents/role-prompts/): the launch wrapper created for each role will have the form `codex-<basename>` for each file in the directory.

> [!NOTE]
> `/status` shows `Agents.md: <none>` due to a [display bug](https://github.com/openai/codex/issues/3793), but the file is loaded regardless.

</details>

<details>
<summary><strong>OpenCode</strong></summary>

1. Run `/status`: Bureau's MCP servers should show as "connected"
2. Press Tab to cycle through agents: Bureau agents should appear

</details>

## Stopping servers

Use the one-shot takedown & cleanup script *(generated by `open-bureau` after launching servers/containers)*:

```bash
$ close-bureau  # in this repo's bin/
```

> *This can also be done manually: the bootstrap/setup scripting prints running server/container PIDs at startup. `close-bureau` is auto-generated with the correct `kill` commands.*

## Configuration (key details)

> [!TIP]
> 
> The content below is limited to key details to help you get rolling as fast as possible.
>
> See [`CONFIGURATION.md`](CONFIGURATION.md) for a **detailed guide and full reference for all config options**.

### How to tweak settings

1. Create a file called `local.yml` in the Bureau repo root **(recommended over changing `directives.yml`)**
2. Place your overrides there *(see the [simple power user `local.yml` config below](#simple-power-user-configuration-example) for inspiration)*.
3. Re-run `open-bureau`. 

The new `local.yml` will be:

- *automatically detected and used* by the Bureau config system
- gitignored for convenience

### Key default config values

| Setting | Default | How to customize |
| :--- | :--- | :--- |
| Enabled CLI agents | All 4 [supported CLIs](#supported-cli-coding-agents) | Set `agents` list in `local.yml` |
| Bureau workspace path | `~/code` | Set `path_to.fs_mcp_whitelist` in `local.yml` |
| Memory retention | 30d–365d, depending on the backend | Set `retention_period_for.*` in `local.yml` |
| [Role prompts](../agents/role-prompts/) and models for PAL `clink` to use with coding CLIs | All role prompts; Sonnet for Claude Code; gpt-5.2-codex with medium reasoning effort for Codex | Set `pal.*` settings in `local.yml` *(see [`directives.yml`](../directives.yml) for quick examples)* | 

### Simple power user configuration example

```yml
# bureau/local.yml (create if it doesn't exist)
mcp:
  auto_approve: yes  

pal:
  claude: 
    model: opus
  codex:
    model: gpt-5.2-codex
    effort: xhigh
```

## Troubleshooting

| Issue | Solution |
|:------|:---------|
| MCP server not starting | Check logs in `/tmp/mcp-*-server.log` |
| Docker not running | Start Docker Desktop / Rancher Desktop first |
| Missing API key warnings | Set the environment variables listed in prerequisites |
| Port conflicts | Override ports in `local.yml` (see [CONFIGURATION.md](CONFIGURATION.md#port_for)) |

> [!NOTE]
> For manual setup steps (symlinking, running individual scripts), see the scripts' sources:
>
> | Script | Role/usage |
> | --- | --- |
> | [`bin/open-bureau`](../bin/open-bureau) | Main bootstrap/setup convenience/wrapper script |
> | [`tools/scripts/set-up-tools.sh`](../tools/scripts/set-up-tools.sh) | MCP/tooling setup | 
> | [`protocols/scripts/set-up-configs.sh`](../protocols/scripts/set-up-configs.sh) | Config/context file setup |
> | [`agents/scripts/set-up-agents.sh`](../agents/scripts/set-up-agents.sh) | Agent-/role-related setup |
