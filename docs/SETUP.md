# Setup guide

Bureau's bootstrap script handles all configuration automatically, providing sensible defaults. 

> [!TIP]
>
> ### Abbreviated setup steps (<5 minutes)
> 
> 1. **Ensure deps:** Node.js 20+, Python 3.12+ with [`uv`](https://docs.astral.sh/uv/), Docker daemon *(Rancher or Docker Desktop)*
> 2. In your shell profile (`.zshrc`/`.bashrc`): 
>     
>     - **Set API keys:** `TAVILY_API_KEY`, `BRAVE_API_KEY`, `CONTEXT7_API_KEY` **(all offer free tiers)**
>     - Add the [`bureau/bin/`](../bin/) directory to `$PATH`
>
> 3. **Run [`open-bureau`](../bin/open-bureau)** *(`bin/open-bureau` if `bureau/bin/` wasn't added to `$PATH`)*
> 4. *Only if using Claude Code:* install the **Claude Code plugins** [discussed below](#claude-code-specific-plugins-highly-recommended)
> 5. Follow the **verification steps** [discussed below](#verify-setup-optional) to ensure setup was successful.
> 6. **When you take a break:** 
>   
>     - Stop the local servers & containers **in seconds with one quick script:** `close-bureau` *(generated by `open-bureau`)*
>     - To start Bureau up again, simply re-run `open-bureau` *(should take <15 seconds after the first-ever run)*
> 
> See below for details, optional plugins, and customization.

## Prerequisites

### Supported CLI coding agents

To use Bureau, you need at least one of the following:

| Supported agent CLI | User-scoped config dir *(that Bureau will configure)* |
| --- | --- |
| Claude Code | `~/.claude/` (and `.claude.json` indirectly via `claude ...` commands) |
| Codex | `~/.codex/` |
| Gemini CLI | `~/.gemini/` |
| OpenCode | `~/.config/opencode/` |

### Dependencies 

- Node.js 20+ (includes npm 10+)
- Python 3.12+ with [`uv`](https://docs.astral.sh/uv/)
- Docker Desktop or Rancher Desktop

### API keys *(for remote/cloud-based MCP servers)*

> [!NOTE]
> All the servers requiring API keys have **free versions with generous monthly usage limits: you don't have to pay anything to use them** if you don't want to.

Make sure the following environment variables are set (e.g. in your `.zshrc/.bashrc`):

- `TAVILY_API_KEY` [(get one here)](https://www.tavily.com/)
- `BRAVE_API_KEY` [(get one here)](https://brave.com/search/api/)
- `CONTEXT7_API_KEY` [(get one here)](https://console.upstash.com/)

## Setup

**Run the idempotent, one-shot bootstrap/setup script:**

```bash
./bin/open-bureau
```

> [!IMPORTANT]
>
> The `bin/open-bureau` script:
>
> - may take **up to 5 minutes** on the **first run *only*** 
>   
>   - *this is due to having to clone the MCP servers that must be run from source (cloned to `bureau/.mcp-servers/` by default)*
> 
> - is **idempotent**: running multiple times won't cause any problems or cause any unnecessary server/container restarts
> - **<ins>must</ins> be re-run after editing any of the `.yml` configs** (i.e. `charter.yml`, `directives.yml` or `local.yml`)
> 

> [!TIP]
> Add `bin/` to your `$PATH` to run `open-bureau` **(and the `close-bureau` shutdown script)** from anywhere:
> ```bash
> export PATH="/path/to/bureau/bin:$PATH"
> ```

### What `open-bureau` does

1. Checks prerequisites and installs Python dependencies
2. Clones MCP servers that must be run from source
3. Starts MCP servers (and backing containers where needed) and sets up all enabled CLI agents to use them
4. Sets up agent role prompts and custom slash commands/launch wrappers for them *(to allow interactive use as main agents)*
5. Generates context files for each enabled CLI *(and symlinks into the appropriate user-scoped config dir)*: 
    
    - `~/.claude/CLAUDE.md`
    - `~/.codex/AGENTS.md`
    - `~/.gemini/GEMINI.md`
    
> [!NOTE]
> These are the files enabling *automatic context injection*: 
> 
> - They guide agents to read *Bureau's custom context files* that teach them to **<ins>autonomously</ins> use Bureau's functionality** *without* explicitly being prompted to by the user.
> - This **<ins>minimizes the learning curve</ins>, letting you get to work as fast as possible.**

6. Generates:

    - PAL MCP config files for each enabled CLI and symlinks into the PAL MCP config dir (`~/.pal/cli_clients/`)
    - the **`close-bureau` script allowing easy shutdown** of *all* daemons/containers launched by Bureau *(placed in the `bureau/bin/` directory)*

> [!IMPORTANT]
>
> - **Shut down Bureau** when you're not working or using it with `bin/close-bureau` (or `close-bureau` if in `$PATH`).
> - Restarting Bureau *(i.e. its local servers/containers)* with `open-bureau` is **easy and quick *(<15 seconds)*** (after the first run).

## Claude Code-specific plugins

After launching Claude Code, install these plugins *(highly recommended for **even more accurate & reliable autonomous agents**)*:

```
/plugin marketplace add thedotmack/claude-mem
/plugin install claude-mem

/plugin marketplace add obra/superpowers-marketplace
/plugin install superpowers@superpowers-marketplace
```

> [!NOTE]
> 
> Codex also works with Superpowers: Bureau sets it up **automatically** (via cloning the repo to the user-scoped `~/.codex/`).\
> No manual setup is needed.

## Customization

### Overriding/customizing configuration

1. Create a file called `local.yml` in the repo root (i.e. `bureau/local.yml`)
2. Place your overrides there
3. Re-run `open-bureau`. 

The new `local.yml` will be:

- *automatically detected and used* by the Bureau config system
- gitignored for convenience

### Key default config values

| Setting | Default | How to customize |
| :--- | :--- | :--- |
| Enabled CLI agents | All 4 [supported CLIs](#supported-cli-coding-agents) | Set `agents` list in `local.yml` |
| Filesystem MCP whitelisted path | `~/code` | Set `path_to.fs_mcp_whitelist` in `local.yml` |
| Memory retention | 30dâ€“365d, depending on the backend | Set `retention_period_for.*` in `local.yml` |
| [Role prompts](../agents/role-prompts/) and models for PAL `clink` to use with coding CLIs | All role prompts; Sonnet for Claude Code; gpt-5.2-codex with medium reasoning effort for Codex | Set `pal.*` settings in `local.yml` *(see `directives.yml` for quick examples)* | 

See [`CONFIGURATION.md`](CONFIGURATION.md) for all options.

## Verify setup (optional)

<details>
<summary><strong>Claude Code</strong></summary>

1. Run `/status`: it should show `Memory: user (~/.claude/CLAUDE.md)`
2. Run `/mcp`: it should list Bureau's MCP servers (qdrant, sourcegraph, etc.)
3. Run `/explainer` *(custom role activation command set up by Bureau)*: it should launch the [`explainer`](../agents/role-prompts/explainer.md) agent for interactive use in the main conversation.

    > You can test this with any role prompt in [`agents/claude-subagents/`](../agents/claude-subagents/): the custom command created for each role will have the form `/<basename>`, using the basename of each file in the directory.

4. If `claude-mem` is installed, you'll see context loaded at startup

</details>

<details>
<summary><strong>Gemini CLI</strong></summary>

1. Run `/memory show`: should show content from `GEMINI.md`
2. Check `Using:` line shows `1 GEMINI.md file`
3. Run `gemini-explainer` *(custom launch wrapper set up by Bureau)* from the command line to see if it launches Gemini with the [`explainer`](../agents/role-prompts/explainer.md) agent active in the *main conversation*
    
    > You can test this with any role prompt in [`agents/role-prompts/`](../agents/role-prompts/): the launch wrapper created for each role will have the form `gemini-<basename>` for each file in the directory.

</details>

<details>
<summary><strong>Codex</strong></summary>

1. Ask: "What must-read files were you given?"
2. Should reference delegation rules and clink
3. Run `~/.codex/superpowers/.codex/superpowers-codex find-skills` to verify Superpowers
4. Run `codex-explainer` *(custom launch wrapper set up by Bureau)* from the command line to see if it launches Codex with the [`explainer`](../agents/role-prompts/explainer.md) agent active in the *main conversation*
    
    > You can test this with any role prompt in [`agents/role-prompts/`](../agents/role-prompts/): the launch wrapper created for each role will have the form `codex-<basename>` for each file in the directory.

> [!NOTE]
> `/status` shows `Agents.md: <none>` due to a [display bug](https://github.com/openai/codex/issues/3793), but the file is loaded regardless.

</details>

<details>
<summary><strong>OpenCode</strong></summary>

1. Run `/status`: Bureau's MCP servers should show as "connected"
2. Press Tab to cycle through agents: Bureau agents should appear

</details>

## Stopping servers

```bash
./bin/close-bureau
```

> Can also be done manually: the bootstrap/setup scripting prints PIDs at startup, with `close-bureau` simply being auto-generated with the correct `kill` commands.

## Troubleshooting

| Issue | Solution |
|:------|:---------|
| MCP server not starting | Check logs in `/tmp/mcp-*-server.log` |
| Docker not running | Start Docker Desktop / Rancher Desktop first |
| Missing API key warnings | Set the environment variables listed in prerequisites |
| Port conflicts | Override ports in `local.yml` (see [CONFIGURATION.md](CONFIGURATION.md#port_for)) |

> [!NOTE]
> For manual setup steps (symlinking, running individual scripts), see the scripts' sources:
>
> | Script | Role/usage |
> | --- | --- |
> | [`bin/open-bureau`](../bin/open-bureau) | Main bootstrap/setup convenience/wrapper script |
> | [`tools/scripts/set-up-tools.sh`](../tools/scripts/set-up-tools.sh) | MCP/tooling setup | 
> | [`protocols/scripts/set-up-configs.sh`](../protocols/scripts/set-up-configs.sh) | Config/context file setup |
> | [`agents/scripts/set-up-agents.sh`](../agents/scripts/set-up-agents.sh) | Agent-/role-related setup |
