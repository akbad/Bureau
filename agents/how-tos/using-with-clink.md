# Using v3-superstars prompts with clink

This guide shows how to make the prompts in `agents/v3-superstars/` available as reusable Zen clink roles from any project. It covers exactly where configuration and prompt files should live, how clink resolves them, and foolproof steps to test and troubleshoot.

> What you will get

- A user-level clink configuration under your home directory
- Role entries that point to your v3-superstars prompt files
- Working `clink` calls like: `clink with gemini role=superstars_research …`


## overview

Zen’s clink tool reads two things at startup:

- CLI client configs: JSON files that define available CLIs and roles
- Role prompts: plain-text/markdown files referenced by those JSONs via `prompt_path`

By default, Zen ships with built-in examples under its project’s `conf/` and `systemprompts/` folders. For user-level, reusable setups, clink also loads configs from your home directory, which is what we will use.


## where configuration and prompts go

There are three supported locations for clink’s CLI client configs (searched in the following priority order):

- Built-in defaults in the Zen repo: `conf/cli_clients/*.json`
- Optional environment override: directory or file pointed to by `CLI_CLIENTS_CONFIG_PATH`
- User overrides: `~/.zen/cli_clients/*.json`

How `prompt_path` is resolved for a role:

- If `prompt_path` is a relative path, clink resolves it relative to the configuration file’s directory first.
- If not found there, it falls back to the Zen project root (where the built-in prompts live).
- Absolute paths are always accepted.

Practical implications:

- Put your user-level JSONs in `~/.zen/cli_clients` and either

    - store the role prompt files alongside them (for example under `~/.zen/cli_clients/systemprompts/clink/...`) and reference them with a relative path, or
    - keep your prompt files anywhere you like (for example, where they already are inside your repo) and set `prompt_path` to an absolute path.

Notes:

- `~/.zen/cli_clients` is the only user-specific directory that clink discovers automatically. A separate `~/.zen/prompts` directory is convenient for you, but clink does not auto-scan it; you must point `prompt_path` to it explicitly if you use it.
- Out of the box, clink supports three CLIs: `gemini`, `codex`, and `claude`. Adding brand-new CLIs requires defining a parser/agent beyond the scope of this guide.


## recommended user-level layout

This puts everything under your home directory so the roles are reusable across all repos and agents.

```
~/.zen/
    cli_clients/
        gemini.json
        codex.json
        claude.json
        systemprompts/
            clink/
                v3-superstars/
                    by-gemini/
                        research-synthesizer.md
                        prompt-engineer.md
                        ...
                    by-claude/
                        architecture-agent.md
                        ...
                    by-gpt/
                        architecture-and-design.md
                        ...
```

You can copy or symlink from your repo to avoid duplication.

```bash
# example: mirror your repo prompts into your home config with symlinks
mkdir -p ~/.zen/cli_clients/systemprompts/clink/v3-superstars
ln -s \
    "$PWD/agents/v3-superstars/by-gemini" \
    ~/.zen/cli_clients/systemprompts/clink/v3-superstars/by-gemini
ln -s \
    "$PWD/agents/v3-superstars/by-claude" \
    ~/.zen/cli_clients/systemprompts/clink/v3-superstars/by-claude
ln -s \
    "$PWD/agents/v3-superstars/by-gpt" \
    ~/.zen/cli_clients/systemprompts/clink/v3-superstars/by-gpt
```


## step 1: ensure zen clink server is running

If you are using the setup script in this repo (`mcps/scripts/set-up-mcps.sh`), it runs Zen MCP in HTTP mode with only clink enabled.

- After running the script, the Zen server runs on `http://localhost:8781/mcp/`.

- Logs are written to a temporary file. If you need to inspect startup or runtime messages, check the log generated by the setup script’s HTTP launcher. On macOS/Linux you can typically find it at:

    - `/tmp/mcp-Zen MCP-server.log`

    The filename includes spaces; if using shell commands, remember to quote the path.

If you are not using the script, follow Zen’s README to run the server and register it with your CLI client. The built-in examples also work when Zen is launched directly via `uvx`.


## step 2: create user-level CLI client configs

Create `~/.zen/cli_clients/gemini.json` with new roles pointing at your v3-superstars prompts.

Example using relative `prompt_path`s that match the recommended layout above:

```json
{
    "name": "gemini",
    "command": "gemini",
    "additional_args": ["--yolo", "-o", "json"],
    "env": {},
    "roles": {
        "default": {
            "prompt_path": "systemprompts/clink/default.txt"
        },

        "superstars_research": {
            "prompt_path": "systemprompts/clink/v3-superstars/by-gemini/research-synthesizer.md"
        },
        "superstars_prompt_engineer": {
            "prompt_path": "systemprompts/clink/v3-superstars/by-gemini/prompt-engineer.md"
        }
    }
}
```

Alternatively, reference your existing repo files with absolute paths:

```json
{
    "name": "gemini",
    "command": "gemini",
    "additional_args": ["--yolo", "-o", "json"],
    "env": {},
    "roles": {
        "default": { "prompt_path": "systemprompts/clink/default.txt" },
        "superstars_architect": {
            "prompt_path": "/absolute/path/to/your/repo/agents/v3-superstars/by-claude/architecture-agent.md"
        }
    }
}
```

Repeat for `~/.zen/cli_clients/codex.json` and `~/.zen/cli_clients/claude.json` as desired. You can use the built-in examples as a base and just add your custom roles. For example:

```json
{
    "name": "codex",
    "command": "codex",
    "additional_args": ["--json", "--dangerously-bypass-approvals-and-sandbox"],
    "env": {},
    "roles": {
        "default": { "prompt_path": "systemprompts/clink/default.txt" },
        "superstars_codereviewer": {
            "prompt_path": "systemprompts/clink/v3-superstars/by-gpt/observability-incident.md"
        }
    }
}
```

```json
{
    "name": "claude",
    "command": "claude",
    "additional_args": ["--print", "--output-format", "json", "--permission-mode", "acceptEdits", "--model", "sonnet"],
    "env": {},
    "roles": {
        "default": { "prompt_path": "systemprompts/clink/default.txt" },
        "superstars_planner": {
            "prompt_path": "systemprompts/clink/v3-superstars/by-claude/architecture-agent.md"
        }
    }
}
```

About the flags:

- The shipped defaults for clink include permissive flags so the sub-CLI can freely read/edit files and use its tools. You can remove or adjust these flags in your JSONs if you want tighter guardrails.


## step 3: optional custom location with CLI_CLIENTS_CONFIG_PATH

If you prefer to keep your CLI configs somewhere other than `~/.zen/cli_clients`, set the environment variable `CLI_CLIENTS_CONFIG_PATH` to a directory or a single file:

```bash
export CLI_CLIENTS_CONFIG_PATH="$HOME/my-clink-configs"
# or
export CLI_CLIENTS_CONFIG_PATH="$HOME/my-clink-configs/gemini.json"
```

clink will read JSON files from that path in addition to the built-ins.


## step 4: reload and verify

- Restart your Zen MCP HTTP server if it was already running, so it picks up the new config.

- Validation tips:

    - If a CLI client is not configured correctly, clink raises a clear error like: “No CLI clients configured. Ensure conf/cli_clients contains at least one definition or set CLI_CLIENTS_CONFIG_PATH.”

    - If a `prompt_path` cannot be found, it raises “Prompt file not found: …”. Use absolute paths or verify your relative path is correct relative to the JSON’s directory.

    - The clink tool’s input schema advertises available `cli_name` and `role` enum values to your agent; if your agent supports showing tool schemas, you can confirm your role names appear there.

    - If you used the setup script, you can tail the Zen server log for hints during startup and the first clink call:

        ```bash
        tail -n +1 -f "/tmp/mcp-Zen MCP-server.log"
        ```


## using your v3-superstars roles

From any agent that can call the Zen MCP server (for example, Codex CLI, Claude Code, Gemini CLI), invoke clink and select your CLI and role.

Examples:

```text
clink with gemini role=superstars_research to map our SDK docs and suggest an improved information architecture
```

```text
Use clink with codex role=superstars_codereviewer to audit auth/ for OWASP Top 10 risks
```

```text
Use clink with claude role=superstars_planner to outline a three-phase migration of legacy services
```

Tips:

- If you configure only one CLI (for example, just `gemini.json`), clink can default to it and let you omit `cli_name`.

- You can pass file paths as context. clink forwards file references and lets the sub-CLI decide what to read:

    ```text
    clink with gemini role=superstars_research on these files: src/, docs/architecture.md
    ```


## how clink finds your files and roles

- Config search precedence:

    - Repo built-ins: `conf/cli_clients`
    - `CLI_CLIENTS_CONFIG_PATH` (directory or single JSON)
    - User overrides: `~/.zen/cli_clients`

- Role prompt resolution:

    - Relative `prompt_path` → first resolved relative to the JSON’s directory
    - If not found there → fallback to Zen project root
    - Absolute `prompt_path` → used as-is

- Role names are per-CLI. It is fine to define the same role name in `gemini.json` and `codex.json` pointing to the same or different prompts.


## troubleshooting

- clink cannot find any CLI clients

    - Ensure you have at least one JSON in `~/.zen/cli_clients` or set `CLI_CLIENTS_CONFIG_PATH`.
    - Verify the JSON parses (run it through `jq .` or a JSON validator).

- “Prompt file not found: …”

    - If using a relative `prompt_path`, double-check you placed your prompts under the same directory tree as the JSON so relative resolution works.
    - Otherwise use an absolute path.

- Roles do not show up where you expect

    - Restart the Zen MCP server process to reload configs.
    - If two JSONs define the same CLI `name`, the later one in the search order overrides the earlier. Keep only one definition per CLI `name` across your search paths, or deliberately structure your overrides.

- Sub-CLI blocked from editing files or using tools

    - The example JSONs include permissive flags (for example Gemini’s `--yolo`, Codex’s `--dangerously-bypass-approvals-and-sandbox`, Claude’s `--permission-mode acceptEdits`). Remove or change them if you want stricter behavior.

- Where are logs?

    - When using this repo’s setup script, check the Zen MCP launcher log at `/tmp/mcp-Zen MCP-server.log`.
    - Your primary agent CLI also logs its MCP calls; check its console output.


## appendix: reference examples and defaults

- Built-in clink client examples in Zen:

    - `conf/cli_clients/gemini.json`
    - `conf/cli_clients/codex.json`
    - `conf/cli_clients/claude.json`

- Built-in clink role prompts in Zen:

    - `systemprompts/clink/default.txt`
    - `systemprompts/clink/default_planner.txt`
    - `systemprompts/clink/default_codereviewer.txt`

- Environment variables you may use:

    - `CLI_CLIENTS_CONFIG_PATH` to point clink at your own directory or single JSON file in addition to built-ins
    - `DISABLED_TOOLS` on the Zen server to control which tools are active; the setup script runs Zen with only `clink` enabled for cross-CLI orchestration

- Port and endpoint when using this repo’s setup script:

    - Zen MCP HTTP: `http://localhost:8781/mcp/`

With the configuration above, your `agents/v3-superstars/` prompts become first-class clink roles you can invoke from any supported agent, without copying content into every project.

